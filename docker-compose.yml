version: '3.8'

services:
  # Main FairShare Next.js App
  fairshare:
    build: .
    container_name: fairshare-app
    restart: unless-stopped
    ports:
      - "3001:3000"
    volumes:
      - fairshare-data:/app/data
    environment:
      - NODE_ENV=production
      - DOCLING_SERVICE_URL=http://docling:8000
      - OLLAMA_BASE_URL=http://host.docker.internal:11434
      - OLLAMA_MODEL=llama3:8b
    depends_on:
      - docling
    extra_hosts:
      - "host.docker.internal:host-gateway"

  # Document Parsing Service (Docling)
  docling:
    build: ./python-service
    container_name: fairshare-docling
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      - PYTHONUNBUFFERED=1

  # Cloudflare Tunnel for external access (optional)
  # Uncomment if you want external access without port forwarding
  # tunnel:
  #   image: cloudflare/cloudflared:latest
  #   container_name: fairshare-tunnel
  #   restart: unless-stopped
  #   command: tunnel --url http://fairshare:3000
  #   depends_on:
  #     - fairshare

volumes:
  fairshare-data:
    driver: local
